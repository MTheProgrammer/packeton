{% extends "layout.html.twig" %}

{% block title %}{{ alias|capitalize }} integration - {{ parent() }}{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-xs-12 package">
            <div class="row">
                <div class="col-md-12">
                    <h2 class="title">
                        {{ alias|capitalize }} integration
                    </h2>

                    {% if errorMsg %}
                        <div class="alert alert-danger">
                            <p>Try to regenerate access token/ reinstall integration if you get http access error</p>
                            <p>{{ errorMsg }}</p>
                        </div>
                    {% endif %}

                    {% include 'integration/info_app.html.twig' %}

                    <div class="form-group">
                        <label class="link-gray">Redirect Urls</label>
                        <textarea class="form-control" readonly rows="4" style="max-width: 470px">{{ config.redirectUrls|join("\n") }}</textarea>
                    </div>

                    <div class="form-group">
                        <label class="link-gray">Hook URL</label>
                        <textarea class="form-control" readonly rows="4" style="max-width: 470px">{{ config.hookUrl }}</textarea>
                    </div>

                    <hr>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="btn-group btn-group-xs">
                        <a class="settings action" href="{{ path('integration_settings', {'alias': alias, 'id': oauth.id}) }}">
                            <button type="button" class="btn btn-default">Settings</button>
                        </a>
                    </div>
                </div>
            </div>

            {% set token = csrf_token('token') %}
            {% if orgs|length > 0 %}
            <div class="row">
                <div class="col-md-12">
                    <h2 style="text-align: center">Your Organizations</h2>
                    <p>
                        To use synchronizations, you must select which organizations should be allowed to select packages.
                        If you select Own profile, repositories from the user's profile or to which he has access will be available.
                    </p>

                    <p>
                        Packeton can detect when created a new repository in your version control systems like GitHub and automatically create composer
                        package for it.
                        Notice: You need to add an organization webhook in case it wasn't automatically created due to a permission error.
                    </p>
                    <br>
                    {% for org in orgs %}
                        <div style="padding-bottom: 25px; max-width: 420px; display: flex; justify-content: space-between">
                            <div>
                                {% if org['logo'] is defined and org['logo'] %}
                                    <img src="{{ org['logo'] }}" height="40">
                                {% endif %}
                                <b>{{ org['name'] }}</b>
                                {% if org['identifier'] == '@self' %}<p class="link-gray" style="font-size: 0.8em; margin: 0">{{ 'integration.self_help'|trans }}</p>{% endif %}
                            </div>

                            <a class="settings action connect" href="{{ path('integration_connect_org', {'alias': alias, 'id': oauth.id}) }}"
                               data-token="{{ token }}" data-org="{{ org['identifier'] }}"
                            >
                                {% if oauth.connected(org['identifier']) %}
                                    <button type="button" class="btn btn-danger" style="padding: 5px 12px">Disconnect</button>
                                {% else %}
                                    <button type="button" class="btn btn-primary" style="padding: 5px 12px">Connect</button>
                                {% endif %}
                            </a>
                        </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
{% endblock %}


{% block scripts %}
    <script src="{{ asset('packeton/js/integration.js')}}"></script>
{% endblock %}
